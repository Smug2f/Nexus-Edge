package com.gamesense.client.module.modules.exploits;

import com.gamesense.api.event.events.PlayerMoveEvent;
import com.gamesense.api.setting.values.BooleanSetting;
import com.gamesense.api.setting.values.IntegerSetting;
import com.gamesense.api.setting.values.ModeSetting;
import com.gamesense.api.util.world.MotionUtil;
import com.gamesense.client.module.Category;
import com.gamesense.client.module.Module;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import me.zero.alpine.listener.MethodRefListener;
import net.minecraft.network.play.client.CPacketPlayer;

import java.util.Arrays;

@Module.Declaration(name = "ClipFlight", category = Category.Exploits)
public class ClipFlight extends Module {

    ModeSetting flight = registerMode("Mode", Arrays.asList("Flight", "Clip"), "Clip");
    IntegerSetting packets = registerInteger("Packets", 80, 1, 300);
    IntegerSetting speed = registerInteger("XZ Speed", 7, -99, 99, () -> flight.getValue().equalsIgnoreCase("Flight"));
    IntegerSetting speedY = registerInteger("Y Speed", 7, -99, 99, () -> !flight.getValue().equalsIgnoreCase("Relative"));
    BooleanSetting bypass = registerBoolean("Bypass", false);
    IntegerSetting interval = registerInteger("Interval",25,1,100, () -> flight.getValue().equalsIgnoreCase("Clip"));
    BooleanSetting update = registerBoolean("Update Position Client Side", false);

    int num = 0;

    double startFlat = 0;

    public void onEnable() {
        startFlat = mc.player.posY;
        num = 0;
    }

    @EventHandler
    private final Listener<PlayerMoveEvent> playerMoveEventListener = new Listener<>(event -> {

        double[] dir = MotionUtil.forward(speed.getValue());

        double yposition;

        switch (flight.getValue()) {

            case "Flight":
                double xPos = mc.player.posX;
                double yPos = mc.player.posY;
                double zPos = mc.player.posZ;

                if (mc.gameSettings.keyBindJump.isKeyDown() && !mc.gameSettings.keyBindSneak.isKeyDown())
                    yPos += speedY.getValue();
                else if (mc.gameSettings.keyBindSneak.isKeyDown())
                    yPos -= speedY.getValue();

                xPos += dir[0];
                zPos += dir[1];

                mc.player.connection.sendPacket(new CPacketPlayer.Position(xPos, yPos, zPos, false));
                if (update.getValue())
                    mc.player.setPosition(xPos, yPos, zPos);
                if (bypass.getValue())
                    mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX,mc.player.posY + 0.05, mc.player.posZ, true));

                break;


            case "Clip":

                if (mc.gameSettings.keyBindSprint.isKeyDown() || mc.player.ticksExisted % interval.getValue() == 0) {
                    for (int i = 0; i < packets.getValue(); i++) {

                        yposition = mc.player.posY + speedY.getValue();

                        mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX, yposition, mc.player.posZ, false));
                        if (update.getValue()) mc.player.setPosition(mc.player.posX, yposition, mc.player.posZ);
                        if (bypass.getValue())
                            mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX,mc.player.posY + 0.05, mc.player.posZ, true));

                        }
                    }


                break;

        }

    });
}


